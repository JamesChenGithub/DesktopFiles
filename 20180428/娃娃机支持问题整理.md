
## 蘑菇街 
### 方案：
* 互动直播模式，配置UDT，低延时; （因要与现有的版本互通，未引导使用极速模式）
* 娃娃机端：PC端程序双开两个客户端;
* 旁路出流，CGI加速，小程序端操作；

### 问题：
* 延时在1.2--1.5秒左右；现有的配置如果网络抖动，容易出现卡顿；
* 静止画面码率不高：静止时画面码率在150k左右，出现码率下溢（SDK给的叫法），与spear配置的400kbps不符；  **解决办法：通过修改QP值（15-40），使码率达到要求。另个在验证过程中发现：只要spear最小码率小于400k时，码率就会下溢。修改后，帧率略有下降（之前是15fps, 改之后在12fps）**;
* 主播，连麦旁路推流画面不对（分辨率不对，方向不对）： <br/>
		分辨率不对：1.主播端使用480x360配置创建房间；2.连麦观众经观众身份切角色进房；原因：**观众角色的视频配置（640_368）与连麦角色的视频配置不一致，导致在切换角色时，先使用的观众角色上行并推流，导致分辨率不对（此处建议：如果要上麦，观众与连麦角色的视频配置尽量一致）;** <br/>
		方向不对：蘑菇街未开转置，推出的流本应竖直方向的，但实际却是横屏方向：**解决办法：在PC预处理回调中，调整帧角度，同时，将画面I420数据作旋转；**，随心播上是开转置的，目前还调不了该效果；
		
* 操作者从观众到实际上麦操作娃娃机，刚开始的画面延时会有些大，这个过程约会持续3-5s : 原因：观众延时切到连麦延时，这个中间有个调控过程，目前无法完全去掉，只有减少观看时的延时配置，来达到效果；

* 日志不好查问题 ： 1.因为是双开客户端，两个帐户的日志输出到同一处，导致查问题时，要手动区分不同帐号，不方便查；2.因为娃娃机上长时间直播，日志非常大，而且找不到头，不好查

* 最开始时，娃娃机上CPU较高：娃娃机上不配置下行权限；

* 以观众角色使用UDT操作抓手，测试时，发现延时在1.5s以内，但真实上线时，却会的2-3秒的延迟：观众角色原因DC／OC逻辑此处是不可控的，具观众角色的延时配置在DC上生效，在OC上不生效，这样会就会导致线上走OC，延时配置后后台调控，即会测出上述延时。目前给蘑菇街的应急方案是使用UDP，延时方面在500ms左右，但网络抗性较差，易出现卡顿；已引导其使用连麦观众角色进房（目前其线上代码写死，必须要升级才可以处理）；
	


## 人人抓娃娃
### 方案：
* 互动直播模式，配置UDT，低延时; （因未定级，暂未引导极速模式）；
* 娃娃机端，android盒子：插两个摄像头，双开帐号，进行直播；

### 问题：
1. 不稳定：目前直播过程中经常就断流了，查看过日志主要是设备操作重复了；主要原因是目前目前支持android盒子硬件与android手机不一致；SDK对android盒子支持不够好；


## 兑吧
### 方案
* 极速模式；
* 娃娃机端，android盒子：插两个摄像头，双开帐号，进行直播；
* 控制信令走AVSDK的自定义数据通道（必须要有上行音频或视频）

### 问题：
1. 控制信令容易丢，且顺序无法保证，网络抗性较差：未改之前延时较大，在1s左右。后来在客户端与娃娃机上添加简单的重传以及信令seq逻辑之后，延时在500ms;
2. 延时问题：调到500ms之后，用户反馈还是有些大：作了以下调整：1. 降码率，调高帧率 （降码率，延时改变不明显，调低帧率，延时会加大，调高后，采集端波动较大，延时不稳定）；2. 娃娃机上去掉美颜等预处理逻辑，延时降到450ms；3. 调音频jitbuf, 默认是400-1000, 调到100-500后，延时降到 400ms;
3. 极速模式，默认开静音检测，配置spear时记得要打开；
4. 现有android盒子，无法打开两个摄像头；已提需求单；
5. 录制约30操作过程：1. 手动录制，有较大概率会丢几秒数据，录制完成无法自动回调业务后台，业务后台要按文件名方式去查询；2.手动推流自动录制：录制文件无法设备业务信息，这块目前wilder跟youngwqwu在调；


## 后期娃娃机上集成可能遇到的问题
1. 娃娃机配置：娃娃机上可以不配置下行权限（极速模模式下需要至少配置下行音频权限）或进房option中配置不自动拉视频流，可减少娃娃机上资源占用；
2. 观众端：通常观众端只显示娃娃机上的主摄像头画面，可建议用户：1. 自动拉画面，只是在渲染上只显示一路，切娃娃机画面时，更新渲染即可；2. 进房option中配置不自动拉视频流，关自动推送，进房后，手动拉主摄像头画面，切画面时也手动拉画面；
3. 娃娃机上日志不好查问题：1.基本上都是双开应用，然后日志输出到同一文件。建议SDK这里增加显示配置日志文件路径API；2.日志文件过大，很多关键信息拿不到；
4. 娃娃机上双开帐号时，引导客户代码进房时要错开，不然极易引起操作硬件报1003;

娃娃机需求：
1. 画面延时低；
2. 操作延时低；
3. 能够录制操作者操作娃娃机时的视频；
