## vipkid毫秒录制问题同步

### 背景
1. vipkid 1V1课堂需要将上课时老师学生的音视频单独录制，录制的视频最终会在客户端和课件一起作对齐播放，以模拟真实上课效果；
2. 因涉及到课件资源，vipkid未采用混流录制方案；
3. 为了尽可能还原上课效果，生成的两路录制文件的时间戳要精确到毫秒级（**原录制系统只支持秒级时间戳**），**且回放的内容偏差不能小于500ms，vipkid称声网方案已满足其需求**；

### 遗留问题
1. 测试环境下，极速模式测得的生成的录制文件（uploader录制）的时间戳，无法较好的对齐，两个文件的时间戳偏差较大（目前测得的数据在 400-1500ms间），无法满足vipkid需求；
2. 在1基础上，后台在测试环境下新增原直播录制跟uploader录制，同时录制两路流进行对比测试（**主要验证uploader录制时间戳偏差的原因**）：原直播录制只支持互动直播录制，本次测试是在互动直播模式下进行测试，得出的结论：1. 原直播录制生成录制文件的时候戳能满足vipkid需求，uploader录制文件时间戳效果较之前好，但时间戳会超前现象，也出现加速播的现象；2. 结论与预期相违悖，同时本次测试在互动直播下进行，不能直播说明极速模式下无的问题，需要更多的用例进行对比；
3. 该测试流程相当复杂（1.模拟上课流程；2.到测试服务器数据库查询录制信息，并生成用于回放的工具（基于ffplay的程序）; 3. 人工对比延时，截图程序对比延时），所有步骤人工参与较高，所得出来的结论主观性太强，不好进行大规模测试。同时也是在测试环境下进行的，无法较好的模拟vipkid真实跨国场景；

### 时间轴

<table>
  <tr>
    <th width="120px">时间</th>
    <th style="text-align:left;vertical-align:middle;">事件记录</th>
  </tr>
  <tr>
    <th> 2017.8 </th>
    <th style="text-align:left;vertical-align:middle;">开始对接vipkid各项需求；并提供Demo</th>
  </tr>
  <tr>
    <th>  2017.10 </th>
    <th style="text-align:left;vertical-align:middle;"> vipkid开始对接，并提出录制文件回放问题</th>
  </tr>
  <tr>
    <th>  2017.11 </th>
    <th style="text-align:left;vertical-align:middle;"> 录制后台录制文增加ms级时间，客户端使用AVSDK，极速模式，按vipkid要求流程在测试环境进行测试（**测试方法:1. 两个客户端的摄像头同时对准秒表；2. 生成的录制文件按时间戳同步后，同一时刻画面不出现要固定**）。测试结果反馈给vipkid，vipkid反馈有**加速播放问题（两路视频文件在按时间戳对齐之后，播放一段时间后，会出现一路视频画面快于另外一路）**</th>
  </tr>
  <tr>
    <th>  2017.12 </th>
    <th style="text-align:left;vertical-align:middle;"> 因AVSDK接口易用性等问题，vipkid暂停接入。**但录制问题后来有确认，当时测试环境网络有丢包是导致出现加速播的原因。但因vipkid暂停接入，未继续深挖原因**</th>
  </tr>
  <tr>
    <th>  2018.2--2018.4 </th>
    <th style="text-align:left;vertical-align:middle;"> 实验室推出新的xcast，接口上满足vipkid要求。跟vipkid多次沟通后，我们在xcast基础上，在封装完给vipkid所要的xlive接口，并提供Demo接入。同时使用新demo测试录制问题，依然存在问题（1.加速播放问题； 2. 录制时间戳偏差大，无法用于对齐），但监控显示测试环境并无丢包</th>
  </tr>
    <tr>
    <th>  2018.5上旬 </th>
    <th style="text-align:left;vertical-align:middle;"> 跟推流、录制后台后台确认：解决了极速模式下uploader录制文件加速播放的问题；但依然存在**录制文件时间戳偏差大**</th>
  </tr>
   <tr>
    <th>  2018.5中旬--至今 </th>
    <th style="text-align:left;vertical-align:middle;"> 后台在测试环境下新增原直播录制跟uploader录制进行对比测试（**主要验证uploader录制时间戳偏差的原因**），测试后得到的结论与之前的相悖</th>
  </tr>
</tb>

<!--1. **2017.8**    开始对接vipkid各项需求；
2. **2017.10**	vipkid开始对接，并提出录制文件回放问题；
3. **2017.10**	录制后台录制文增加ms级时间，客户端使用AVSDK，极速模式，按vipkid要求流程在测试环境进行测试（**测试方法:1. 两个客户端的摄像头同时对准秒表；2. 生成的录制文件按时间戳同步后，同一时刻画面不出现要固定**）。测试结果反馈给vipkid，vipkid反馈有**加速播放问题（两路视频文件在按时间戳对齐之后，播放一段时间后，会出现一路视频画面快于另外一路）**。
4. **2017.11**	因AVSDK接口易用性等问题，vipkid暂停接入。**但录制问题后来有确认，当时测试环境网络有丢包是导致出现加速播的原因。但因vipkid暂停接入，未继续深挖原因**。
5. **2018.2--2018.4**  实验室推出新的xcast，接口上满足vipkid要求。在封装完给vipkid所要的xlive接口以及Demo之后，使用新demo测试，依然存在该问题，但监控显示测试环境并完丢包；
6. **2018.5上旬** 跟推流、录制后台后台确认：解决了极速模式下uploader录制文件加速播放的问题；但依然存在**录制文件时间戳偏差大**
7. **2018.5中旬** 后台在测试环境下新增原直播录制跟uploader录制进行对比测试（**主要验证uploader录制时间戳偏差的原因**），测试后得到的结论与之前的相悖；-->
